<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>Green Introduce - Checked</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
/* ê¸°ë³¸ ìŠ¤íƒ€ì¼ (sec1/sec2 ìœ ì§€) */
*{box-sizing:border-box;margin:0;padding:0;font-family: "Noto Sans KR", sans-serif;}
html,body{height:100%;background:#f9fbf9;}
.section{width:100%;height:100vh;display:none;align-items:center;justify-content:center;}
#sec1{display:flex;flex-direction:column;gap:10px;}
.card{background:#fff;padding:24px;border-radius:14px;box-shadow:0 8px 30px rgba(10,30,15,0.06);}
input,textarea,button{font-size:14px;border-radius:8px;padding:10px;border:1px solid #ccc;}
button{background:#4caf50;color:#fff;border:none;cursor:pointer;}
.muted-link{background:none;border:none;color:#888;cursor:pointer;}

/* í”„ë¡œí•„/íƒ‘ë°” */
#profile-bar{position:fixed;left:16px;top:12px;display:flex;align-items:center;gap:10px;z-index:40;display:none;}
#profile-pic{width:44px;height:44px;border-radius:50%;background:#dfeee1 center/60% no-repeat;border:2px solid #e6efe7;cursor:pointer;}
#profile-menu{position:absolute;left:0;top:60px;background:#fff;border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.08);width:260px;display:none;z-index:50;}
#point-display{font-weight:600;color:#2e7d32;}

/* ì„¹ì…˜3 ê·¸ë¦¬ë“œ */
#sec3{display:flex;flex-direction:column;align-items:center;gap:20px;position:relative;padding-top:60px;}
#grid{display:grid;grid-template-columns:repeat(3,220px);grid-template-rows:repeat(2,160px);gap:20px;}
.tile{width:220px;height:160px;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 20px rgba(10,30,10,0.04);cursor:pointer;text-align:center;padding:12px;}
#logo{position:absolute;right:24px;bottom:12px;font-weight:900;font-size:28px;color:rgba(47,157,90,0.28);}

/* ì½˜í…ì¸  ëª¨ë‹¬/í˜ì´ì§€(í•˜ìœ„ ì„¹ì…˜) */
.content-section{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:90%;max-width:900px;height:86vh;background:#fff;border-radius:12px;padding:18px;overflow:auto;box-shadow:0 12px 40px rgba(0,0,0,0.12);z-index:60;}
.content-section h2{color:#2e7d32;margin-bottom:8px;}
.close-btn{position:absolute;right:18px;top:12px;background:none;color:#888;font-weight:700;border:none;cursor:pointer;}
.photo-grid{display:flex;flex-direction:column;align-items:center;gap:12px;padding:8px;}
.photo-grid img{width:90%;max-width:720px;border-radius:10px;object-fit:cover;}

/* Shop */
#shop-items{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;padding:8px;}
.shop-item{width:160px;border-radius:10px;background:#fff;padding:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);text-align:center;}
.shop-item img{width:100%;height:110px;object-fit:cover;border-radius:8px;margin-bottom:6px;}

/* êµ¬ë§¤ ëª¨ë‹¬ (ì˜¤ë²„ë ˆì´) */
.overlay{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:80;}
.modal{background:#fff;padding:18px;border-radius:10px;width:320px;max-width:92%;}
.modal input{width:100%;margin-bottom:8px;}
.small-muted{font-size:13px;color:#777;margin:6px 0;}
</style>
</head>
<body>

<!-- -------------------------
  sec1, sec2ëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í•œ ê·¸ëŒ€ë¡œ ë³´ì¡´
--------------------------- -->

<!-- SECTION 1 (ë¡œê·¸ì¸) -->
<section id="sec1" class="section" style="display:flex;">
  <div class="card">
    <h1 style="margin-bottom:12px">Green introduce</h1>
    <input id="login-id" type="text" placeholder="ì•„ì´ë””">
    <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <div style="display:flex;gap:8px;margin-top:10px;">
      <button id="btn-login" style="flex:1">ë¡œê·¸ì¸</button>
      <button id="btn-show-signup" class="muted-link" style="flex:0">íšŒì›ê°€ì…</button>
    </div>
  </div>
</section>

<!-- SECTION 2 (íšŒì›ê°€ì…) -->
<section id="sec2" class="section">
  <div class="card">
    <h2 style="margin-bottom:10px">íšŒì›ê°€ì…</h2>
    <input id="su-name" type="text" placeholder="ì´ë¦„">
    <input id="su-dob" type="date" placeholder="ìƒë…„ì›”ì¼">
    <input id="su-id" type="text" placeholder="ì•„ì´ë””">
    <input id="su-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <div style="display:flex;gap:8px;margin-top:10px;">
      <button id="btn-do-signup" style="flex:1">íšŒì›ê°€ì…</button>
      <button id="btn-cancel-signup" class="muted-link" style="flex:0">ì·¨ì†Œ</button>
    </div>
  </div>
</section>

<!-- -------------------------
  SECTION 3 (ë©”ì¸ ì¸í„°í˜ì´ìŠ¤) - ì™„ì„±ëœ ê¸°ëŠ¥ í¬í•¨
--------------------------- -->

<section id="sec3" class="section">
  <!-- í”„ë¡œí•„ ë°” (ë¡œê·¸ì¸ ì´í›„ ë³´ì„) -->
  <div id="profile-bar">
    <div id="profile-pic" title="í”„ë¡œí•„ ë³€ê²½"></div>
    <div>
      <div id="profile-name" style="font-weight:700">ë¹„íšŒì›</div>
      <div id="point-display" style="font-size:13px;color:#2e7d32">ğŸ’° 0P</div>
    </div>
    <!-- í”„ë¡œí•„ ë©”ë‰´ (í† ê¸€) -->
    <div id="profile-menu">
      <div style="margin-bottom:8px;font-weight:700">í”„ë¡œí•„ ì„¤ì •</div>

      <div style="display:flex;gap:8px;margin-bottom:8px">
        <div id="avatar-male" class="avatar-option" style="width:44px;height:44px;border-radius:50%;background:url('https://cdn-icons-png.flaticon.com/512/1077/1077114.png') center/64% no-repeat;border:2px solid transparent;cursor:pointer"></div>
        <div id="avatar-female" class="avatar-option" style="width:44px;height:44px;border-radius:50%;background:url('https://cdn-icons-png.flaticon.com/512/4140/4140048.png') center/64% no-repeat;border:2px solid transparent;cursor:pointer"></div>
      </div>

      <div style="font-size:13px;margin-bottom:6px">ë°°ê²½ìƒ‰ ì„ íƒ</div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px">
        <div class="color-option" data-color="#4caf50" style="background:#4caf50;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#2196f3" style="background:#2196f3;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#ffeb3b" style="background:#ffeb3b;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#e91e63" style="background:#e91e63;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#9c27b0" style="background:#9c27b0;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#ff9800" style="background:#ff9800;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#00bfa5" style="background:#00bfa5;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
        <div class="color-option" data-color="#9e9e9e" style="background:#9e9e9e;width:28px;height:28px;border-radius:50%;cursor:pointer;border:1px solid #ccc"></div>
      </div>

      <button id="save-avatar" style="width:100%;margin-bottom:8px">ì €ì¥</button>

      <hr style="margin:8px 0;border:none;border-top:1px solid #eee">

      <div style="font-weight:700;margin-bottom:6px">ì¹´ë“œ/ê³„ì¢Œ ë“±ë¡</div>
      <input id="card-number" placeholder="ê³„ì¢Œë²ˆí˜¸" style="width:100%;margin-bottom:8px">
      <input id="pay-pin" placeholder="ê²°ì œ ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)" style="width:100%;margin-bottom:8px">
      <button id="save-card" style="width:100%;margin-bottom:8px">ì €ì¥ (ê³„ì¢Œ)</button>

      <hr style="margin:8px 0;border:none;border-top:1px solid #eee">

      <div style="font-weight:700;margin-bottom:6px">í¬ì¸íŠ¸ ì¶©ì „</div>
      <input id="charge-amount" type="number" placeholder="ì¶©ì „ ê¸ˆì•¡" style="width:100%;margin-bottom:8px">
      <input id="charge-pin" type="password" placeholder="ê²°ì œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" style="width:100%;margin-bottom:8px">
      <button id="charge-btn" style="width:100%;">ì¶©ì „í•˜ê¸°</button>
    </div>
  </div>

  <!-- íƒ€ì¼ ê·¸ë¦¬ë“œ -->
  <div id="grid">
    <div class="tile" id="tile-main">Main</div>
    <div class="tile" id="tile-challenge">Challenge</div>
    <div class="tile" id="tile-community">Community</div>
    <div class="tile" id="tile-campaign">Campaign</div>
    <div class="tile" id="tile-shop">Shop</div>
  </div>

  <div id="logo">GreenğŸŒ±Life</div>
</section>

<!-- -------------------------
  í•˜ìœ„ ì½˜í…ì¸  ì„¹ì…˜ë“¤
--------------------------- -->

<!-- Main content -->
<aside id="main-section" class="content-section" aria-hidden="true">
  <button class="close-btn" onclick="closeContent('main-section')">âœ•</button>
  <h2>ì˜¤ëŠ˜ì˜ ë¯¸ì…˜</h2>
  <ol>
    <li>ì¼íšŒìš©í’ˆ ì¤„ì´ê¸°</li>
    <li>ë¶„ë¦¬ë°°ì¶œ ì² ì €íˆ í•˜ê¸°</li>
    <li>ì—ë„ˆì§€ ì ˆì•½í•˜ê¸°</li>
    <li>ëŒ€ì¤‘êµí†µ/ìì „ê±° ì´ìš©í•˜ê¸°</li>
    <li>ì¹œí™˜ê²½ ì†Œë¹„ ì‹¤ì²œí•˜ê¸°</li>
  </ol>

  <div style="margin-top:18px;padding:14px;border-radius:10px;background:#e8f5e9;border:1px solid #c8e6c9">
    <h3>ê´‘ê³  â€” GreenEarth Co.</h3>
    <p><strong>GreenEarth Co.</strong>ì˜ ì¹œí™˜ê²½ ì œí’ˆìœ¼ë¡œ ì¼ìƒì—ì„œ ì§€êµ¬ë¥¼ ì§€í‚¤ì„¸ìš”. ì¬í™œìš© ì†Œì¬ Â· íƒ„ì†Œì¤‘ë¦½ ìƒì‚°.</p>
  </div>
</aside>

<!-- Challenge content -->
<aside id="challenge-section" class="content-section" aria-hidden="true">
  <button class="close-btn" onclick="closeContent('challenge-section')">âœ•</button>
  <h2>ìƒíƒœÂ·í™˜ê²½ ê´€ë ¨ ìˆì¸  / ë™ì˜ìƒ</h2>

  <div class="photo-grid" id="challenge-photos" aria-live="polite"></div>

  <div style="margin-top:12px">
    <button id="open-upload">+ ì—…ë¡œë“œ</button>
    <div id="upload-panel" style="margin-top:10px;display:none">
      <input id="media-file" type="file" accept="video/*,image/*"><br>
      <input id="media-title" type="text" placeholder="ë¯¸ë””ì–´ ì œëª©" style="width:60%;margin-top:8px"><br>
      <input id="media-tags" type="text" placeholder="#í•´ì‹œíƒœê·¸" style="width:60%;margin-top:8px"><br>
      <button id="post-media" style="margin-top:8px">ê²Œì‹œí•˜ê¸°</button>
    </div>
  </div>
</aside>

<!-- Community content -->
<aside id="community-section" class="content-section" aria-hidden="true">
  <button class="close-btn" onclick="closeContent('community-section')">âœ•</button>
  <h2>ë¬¸ì˜ì‚¬í•­</h2>
  <textarea id="inquiry" placeholder="ë¬¸ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>

  <h2 style="margin-top:12px">ì˜ê²¬ ê²Œì‹œíŒ</h2>
  <textarea id="opinion" placeholder="ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>

  <div style="margin-top:12px">
    <p>í¬ì¸íŠ¸ë¡œ ìƒíƒœÂ·í™˜ê²½ ë³´í˜¸ ë‹¨ì²´ë¥¼ í›„ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <input id="donation-amount" type="number" placeholder="í›„ì› ê¸ˆì•¡ (P)" style="width:40%;margin-right:8px">
    <button id="donate-btn">í›„ì›í•˜ê¸°</button>
  </div>
</aside>

<!-- Shop content -->
<aside id="shop-section" class="content-section" aria-hidden="true">
  <button class="close-btn" onclick="closeContent('shop-section')">âœ•</button>
  <h2>Shop</h2>
  <input id="shop-search" type="text" placeholder="ìƒí’ˆ ê²€ìƒ‰" style="width:50%;margin-bottom:12px">
  <div id="shop-items"></div>
</aside>

<!-- Purchase overlay modal -->
<div id="overlay" class="overlay">
  <div class="modal" id="purchase-modal-box">
    <h3 id="purchase-title">êµ¬ë§¤ì°½</h3>
    <input id="buy-qty" type="number" placeholder="êµ¬ë§¤ ê°œìˆ˜">
    <input id="buy-name" type="text" placeholder="ì´ë¦„">
    <input id="buy-id" type="text" placeholder="ì•„ì´ë””">
    <input id="buy-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <input id="use-point" type="number" placeholder="ì‚¬ìš©í•  í¬ì¸íŠ¸">
    <div class="small-muted">í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•˜ë©´ ë“±ë¡ëœ ê³„ì¢Œì—ì„œ ë¶€ì¡±ë¶„ë§Œ ìë™ ê²°ì œë©ë‹ˆë‹¤.</div>
    <button id="confirm-purchase">ê²°ì œí•˜ê¸°</button>
    <button id="cancel-purchase" style="background:#ccc;color:#000;margin-top:8px">ì·¨ì†Œ</button>
  </div>
</div>

<!-- Campaign -->
<aside id="campaign-section" class="content-section" aria-hidden="true">
  <button class="close-btn" onclick="closeContent('campaign-section')">âœ•</button>
  <h2>Campaign</h2>
  <button id="open-mission">+ ë¯¸ì…˜ ì˜¬ë¦¬ê¸°</button>
  <div id="mission-panel" style="margin-top:12px;display:none">
    <input id="mission-title" placeholder="ê²Œì‹œë¬¼ ì œëª©" style="width:60%;margin-bottom:8px"><br>
    <textarea id="mission-body" placeholder="ê²Œì‹œë¬¼ ë‚´ìš©" style="width:80%"></textarea><br>
    <button id="post-mission" style="margin-top:8px">ê²Œì‹œí•˜ê¸°</button>
  </div>
</aside>

<script>
/* ---------------------------
   ì „ì—­ ìƒíƒœ ë° ìœ í‹¸
   --------------------------- */
let userDB = {};            // {id,pw,name}
let currentUser = null;
let userPoints = 100;
let accountRegistered = false;
let payPIN = "";
let selectedAvatar = "male";
let selectedBg = "#dfeee1";
let products = [
  {id:1,name:"ëŒ€ë‚˜ë¬´ ì¹«ì†”", price:3000, img:"https://images.unsplash.com/photo-1598966893418-376fda64b4d2?w=800&q=60"},
  {id:2,name:"ì—ì½” í…€ë¸”ëŸ¬", price:5000, img:"https://images.unsplash.com/photo-1563245372-f26b8c7e3a9e?w=800&q=60"},
  {id:3,name:"ë¦¬í•„ ìƒ´í‘¸", price:4000, img:"https://images.unsplash.com/photo-1585238342028-1a7420a2d9e1?w=800&q=60"},
  {id:4,name:"ì—ì½”ë°±", price:2500, img:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800&q=60"},
  {id:5,name:"ì²œì—° ë¹„ëˆ„", price:2000, img:"https://images.unsplash.com/photo-1601046933861-2f3b4e6b8bb1?w=800&q=60"},
  {id:6,name:"ë¬´í”Œë¼ìŠ¤í‹± ì»µ", price:3500, img:"https://images.unsplash.com/photo-1606813902787-4b12b7d88b56?w=800&q=60"},
  {id:7,name:"ì¬í™œìš© ë…¸íŠ¸", price:1500, img:"https://images.unsplash.com/photo-1515879218367-8466d910aaa4?w=800&q=60"},
  {id:8,name:"ì¹œí™˜ê²½ ë¹¨ëŒ€ ì„¸íŠ¸", price:1200, img:"https://images.unsplash.com/photo-1621493353282-f5951d0f2d6b?w=800&q=60"},
  {id:9,name:"ìœ ê¸°ë† ë¹„ëˆ„", price:2200, img:"https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=800&q=60"},
  {id:10,name:"ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í–‰ì£¼", price:1800, img:"https://images.unsplash.com/photo-1556745753-b2904692b3cd?w=800&q=60"}
];

/* DOM lookup */
const el = id => document.getElementById(id);
const sections = {sec1:el('sec1'), sec2:el('sec2'), sec3:el('sec3')};
const profileBar = el('profile-bar'), profileMenu = el('profile-menu');

/* ì´ˆê¸° í‘œì‹œ: sec1 (ë¡œê·¸ì¸) ë³´ì—¬ì£¼ê¸° */
function showSection(node){
  // node can be element
  Object.values(sections).forEach(s => s.style.display='none');
  if(node) node.style.display='flex';
}
showSection(sections.sec1);
updatePointDisplay();

/* ---------------------------
   sec1 <-> sec2 (íšŒì›ê°€ì…)
   --------------------------- */
el('btn-show-signup').addEventListener('click', ()=> showSection(sections.sec2));
el('btn-cancel-signup').addEventListener('click', ()=> showSection(sections.sec1));

el('btn-do-signup').addEventListener('click', ()=>{
  const name = el('su-name').value.trim();
  const dob  = el('su-dob').value;
  const id   = el('su-id').value.trim();
  const pw   = el('su-pw').value.trim();
  if(!name || !dob || !id || !pw){ alert('ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
  userDB = {id,pw,name};
  alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
  showSection(sections.sec1);
});

/* ë¡œê·¸ì¸ */
el('btn-login').addEventListener('click', login);
function login(){
  const id = el('login-id').value.trim();
  const pw = el('login-pw').value.trim();
  if(id === userDB.id && pw === userDB.pw){
    currentUser = userDB.name;
    profileBar.style.display = 'flex';
    el('profile-name').textContent = currentUser;
    updatePointDisplay();
    showSection(sections.sec3);
  } else {
    alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
}

/* ---------------------------
   í”„ë¡œí•„ ë©”ë‰´: í† ê¸€, ì•„ë°”íƒ€, ìƒ‰ìƒ, ì¹´ë“œ ì €ì¥, í¬ì¸íŠ¸ ì¶©ì „
   --------------------------- */
el('profile-pic').addEventListener('click', ()=>{
  profileMenu.style.display = profileMenu.style.display === 'block' ? 'none' : 'block';
});

// avatar selection
el('avatar-male').addEventListener('click', ()=> selectAvatar('male'));
el('avatar-female').addEventListener('click', ()=> selectAvatar('female'));
function selectAvatar(type){
  selectedAvatar = type;
  el('avatar-male').style.border = type === 'male' ? '2px solid #4caf50' : '2px solid transparent';
  el('avatar-female').style.border = type === 'female' ? '2px solid #4caf50' : '2px solid transparent';
}

// color options
document.querySelectorAll('.color-option').forEach(c=>{
  c.addEventListener('click', ()=> {
    selectedBg = c.getAttribute('data-color');
    // highlight selection (simple)
    document.querySelectorAll('.color-option').forEach(x=> x.style.outline='none');
    c.style.outline = '2px solid rgba(0,0,0,0.08)';
  });
});

// save avatar (apply to profile picture)
el('save-avatar').addEventListener('click', ()=>{
  const url = selectedAvatar === 'male' ? 'https://cdn-icons-png.flaticon.com/512/1077/1077114.png' : 'https://cdn-icons-png.flaticon.com/512/4140/4140048.png';
  el('profile-pic').style.background = `${selectedBg} url('${url}') center/60% no-repeat`;
  alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  profileMenu.style.display = 'none';
});

// save card/account
el('save-card').addEventListener('click', ()=>{
  const card = el('card-number').value.trim();
  const pin = el('pay-pin').value.trim();
  if(!card || !pin){ alert('ê³„ì¢Œë²ˆí˜¸ì™€ ê²°ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  accountRegistered = true;
  payPIN = pin;
  alert('ê³„ì¢Œë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
  profileMenu.style.display = 'none';
});

// charge points
el('charge-btn').addEventListener('click', ()=>{
  const amount = parseInt(el('charge-amount').value || '0');
  const pin = el('charge-pin').value;
  if(!accountRegistered){ alert('ë¨¼ì € ê³„ì¢Œë¥¼ ë“±ë¡í•˜ì„¸ìš”.'); return; }
  if(pin !== payPIN){ alert('ê²°ì œ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  if(amount > 0){
    userPoints += amount;
    updatePointDisplay();
    alert(`${amount}P ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    el('charge-amount').value = '';
    el('charge-pin').value = '';
  } else alert('ì¶©ì „ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.');
});

/* ---------------------------
   íƒ€ì¼ í´ë¦­ìœ¼ë¡œ ê° ì½˜í…ì¸  ì—´ê¸°
   --------------------------- */
el('tile-main').addEventListener('click', ()=> openContent('main-section'));
el('tile-challenge').addEventListener('click', ()=> { openContent('challenge-section'); loadChallengePhotos(); });
el('tile-community').addEventListener('click', ()=> openContent('community-section'));
el('tile-shop').addEventListener('click', ()=> { openContent('shop-section'); renderShop(products); });
el('tile-campaign').addEventListener('click', ()=> openContent('campaign-section'));

function openContent(id){
  document.querySelectorAll('.content-section').forEach(s=> s.style.display = 'none');
  el(id).style.display = 'block';
}
function closeContent(id){
  el(id).style.display = 'none';
}

/* ---------------------------
   Challenge: ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸° + ì—…ë¡œë“œ (ê°„ë‹¨)
   --------------------------- */
function loadChallengePhotos(){
  const container = el('challenge-photos');
  // clear
  container.innerHTML = '';
  // sample images already in products or unsplash list
  const list = [
    "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=1200&q=60",
    "https://images.unsplash.com/photo-1523978591478-c753949ff840?w=1200&q=60",
    "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1200&q=60",
    "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1200&q=60",
    "https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=1200&q=60",
    "https://images.unsplash.com/photo-1524594227084-df49dcf0d6d1?w=1200&q=60",
    "https://images.unsplash.com/photo-1502082553048-f009c37129b9?w=1200&q=60",
    "https://images.unsplash.com/photo-1499084732479-de2c02d45fc4?w=1200&q=60",
    "https://images.unsplash.com/photo-1473187983305-f615310e7daa?w=1200&q=60",
    "https://images.unsplash.com/photo-1522205408450-add114ad53fe?w=1200&q=60"
  ];
  list.forEach(u=>{
    const img = document.createElement('img');
    img.src = u;
    img.loading = 'lazy';
    container.appendChild(img);
  });
}
// upload panel
el('open-upload').addEventListener('click', ()=> {
  const panel = el('upload-panel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
});
el('post-media').addEventListener('click', ()=>{
  // in this mock, just notify and hide
  alert('ë¯¸ë””ì–´ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
  el('upload-panel').style.display = 'none';
});

/* ---------------------------
   Community: í›„ì› (í¬ì¸íŠ¸ ì‚¬ìš© / ë¶€ì¡± ì‹œ ê³„ì¢Œê²°ì œ)
   --------------------------- */
el('donate-btn').addEventListener('click', donate);
function donate(){
  const val = parseInt(el('donation-amount').value || '0');
  if(!val || val <= 0){ alert('í›„ì› ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  processPayment(val, 'í›„ì›');
}

/* ---------------------------
   Shop: ë Œë”ë§, ê²€ìƒ‰, êµ¬ë§¤ íë¦„
   --------------------------- */
function renderShop(list){
  const container = el('shop-items');
  container.innerHTML = '';
  list.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'shop-item';
    card.innerHTML = `<img src="${p.img}" alt="${p.name}"><div style="font-weight:700;margin:6px 0">${p.name}</div><div style="color:#777">${p.price}P</div><div style="margin-top:8px"><button data-id="${p.id}" class="buy-btn">êµ¬ë§¤í•˜ê¸°</button></div>`;
    container.appendChild(card);
  });
  // attach listeners to buy buttons
  container.querySelectorAll('.buy-btn').forEach(b=>{
    b.addEventListener('click', (ev)=>{
      const id = parseInt(b.getAttribute('data-id'));
      const prod = products.find(x=>x.id===id);
      openPurchaseModal(prod);
    });
  });
}

// search
el('shop-search').addEventListener('input', (e)=> {
  const q = e.target.value.trim().toLowerCase();
  const filtered = products.filter(p => p.name.toLowerCase().includes(q));
  renderShop(filtered);
});

/* ---------------------------
   Purchase modal handling
   --------------------------- */
function openPurchaseModal(prod){
  el('purchase-title').textContent = `êµ¬ë§¤ - ${prod.name} (${prod.price}P)`;
  el('overlay').style.display = 'flex';
  // store selected product in dataset
  el('confirm-purchase').dataset.productId = prod.id;
}
el('cancel-purchase').addEventListener('click', ()=> el('overlay').style.display='none');
el('confirm-purchase').addEventListener('click', ()=> {
  const prodId = parseInt(el('confirm-purchase').dataset.productId);
  const prod = products.find(p=>p.id===prodId);
  const qty = Math.max(1, parseInt(el('buy-qty').value || '1'));
  const usePoint = parseInt(el('use-point').value || '0');
  const total = prod.price * qty;
  // user identity check (basic)
  const enteredId = el('buy-id').value.trim();
  const enteredPw = el('buy-pw').value;
  if(!enteredId || !enteredPw){ alert('êµ¬ë§¤ì ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if(!userDB.id || enteredId !== userDB.id || enteredPw !== userDB.pw){
    alert('ì…ë ¥í•œ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ê°€ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return;
  }
  // process payment with points + fallback
  const remainingAfterPoint = total - Math.min(usePoint, userPoints);
  const pointUsed = Math.min(usePoint, userPoints);
  userPoints -= pointUsed;
  if(remainingAfterPoint <= 0){
    // full covered by points
    updatePointDisplay();
    alert(`ê²°ì œ ì™„ë£Œ! ${prod.name} ${qty}ê°œë¥¼ ${pointUsed}Pë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.`);
    el('overlay').style.display='none';
    clearPurchaseInputs();
    return;
  }
  // need to charge remainder from account
  if(!accountRegistered){ alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•˜ê³  ë“±ë¡ëœ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤. í”„ë¡œí•„ì—ì„œ ê³„ì¢Œë¥¼ ë“±ë¡í•˜ì„¸ìš”.'); return; }
  const confirmPay = confirm(`í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¶€ì¡±ë¶„ ${remainingAfterPoint}ì›ì„ ê³„ì¢Œì—ì„œ ê²°ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
  if(!confirmPay){ return; }
  const inputPin = prompt('ê²°ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
  if(inputPin !== payPIN){ alert('ê²°ì œ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  // simulate account charge success
  userPoints = 0; updatePointDisplay();
  alert(`ê²°ì œ ì™„ë£Œ! ${prod.name} ${qty}ê°œë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤. í¬ì¸íŠ¸ ${pointUsed}P ì‚¬ìš©, ${remainingAfterPoint}ì› ê³„ì¢Œ ê²°ì œ.`);
  el('overlay').style.display='none';
  clearPurchaseInputs();
});

function clearPurchaseInputs(){
  el('buy-qty').value = '';
  el('buy-name').value = '';
  el('buy-id').value = '';
  el('buy-pw').value = '';
  el('use-point').value = '';
}

/* ---------------------------
   Payment processing used by donate/purchase
   --------------------------- */
function processPayment(amount, label){
  if(amount <= 0){ alert('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if(userPoints >= amount){
    userPoints -= amount;
    updatePointDisplay();
    alert(`${label} ì™„ë£Œ â€” ${amount}Pê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    return;
  }
  // insufficient points
  const shortage = amount - userPoints;
  if(!accountRegistered){ alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•˜ê³  ë“±ë¡ëœ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤. ê³„ì¢Œë¥¼ ë“±ë¡í•˜ì„¸ìš”.'); return; }
  const ok = confirm(`í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¶€ì¡±ë¶„ ${shortage}ì›ì„ ë“±ë¡ëœ ê³„ì¢Œì—ì„œ ê²°ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
  if(!ok) return;
  const input = prompt('ê²°ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
  if(input !== payPIN){ alert('ê²°ì œ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  // simulate charge
  userPoints = 0;
  updatePointDisplay();
  alert(`${label} ì™„ë£Œ â€” ${amount}ì› ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

/* ---------------------------
   Campaign: mission posting
   --------------------------- */
el('open-mission').addEventListener('click', ()=> {
  el('mission-panel').style.display = el('mission-panel').style.display === 'block' ? 'none' : 'block';
});
el('post-mission').addEventListener('click', ()=> {
  const title = el('mission-title').value.trim();
  const body = el('mission-body').value.trim();
  if(!title || !body){ alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  alert('ë¯¸ì…˜ì´ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
  el('mission-title').value = ''; el('mission-body').value = '';
  el('mission-panel').style.display = 'none';
});

/* ---------------------------
   Helpers
   --------------------------- */
function updatePointDisplay(){
  el('point-display').textContent = `ğŸ’° ${userPoints}P`;
}

/* safe getElement fallback */
function $(id){ return document.getElementById(id); }
</script>
</body>
</html>
